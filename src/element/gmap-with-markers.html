<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/bower_components/iron-ajax.html">

<script src="./markerclusterer.js" type="text/javascript"></script>
<script src="data.json"></script>
<link rel="import" href="../../../bower_components/google-map/google-map.html">
<link rel="import" href="../../../bower_components/google-apis/google-maps-api.html">
<link rel="import" href="../../../bower_components/google-map/google-map-point.html">
<link rel="import" href="../../../bower_components/google-map/google-map-marker.html">
<link rel="import" href="../../../bower_components/google-map/google-map-poly.html">
<dom-module id="gmap-with-markers">
    <template>
        <style>
        .mymap {
            width: 700px;
            height: 700px;
            display: inline-flex;
        }
        </style>
        <div id='map' class="mymap"></div>
        <iron-ajax
             url="./data.json"
             id="xhr"
             handle-as="json"
             on-response="drawMap"
             last-request="{{data}}"></iron-ajax>
        <google-maps-api id='gmap' api-key="AIzaSyBw9aJOCPfc4Hel0sTET3DgwJhuDeCDqdc" version="3.exp"></google-maps-api>
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'gmap-with-markers',

            ready: function() {

                this.$.gmap.addEventListener('api-load', function(e) {
                    // this.api === google.maps
                    this.$.xhr.generateRequest()
                }.bind(this));

            },
            drawMap: function() {
                var center = new google.maps.LatLng(37.4419, -122.1419);

                var map = new google.maps.Map(this.$.map, {
                    zoom: 3,
                    center: center,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });

                var markers = [];
                for (var i = 0; i < 100; i++) {
                    var dataPhoto = data.photos[i];
                    var latLng = new google.maps.LatLng(dataPhoto.latitude,
                        dataPhoto.longitude);
                    var marker = new google.maps.Marker({
                        position: latLng
                    });
                    markers.push(marker);
                }
                var markerCluster = new MarkerClusterer(map, markers, { imagePath: '../images/m' });

                // body...
            },
            properties: {
                mapSize: {
                    type: String,
                    notify: true,
                    default: "width:500px;height:500px;display: inline-flex;"
                },
                lat: {
                    type: Number
                },
                long: {
                    type: Number
                },
                poi: {
                    type: Array,
                    notify: true
                }

            }
        })
    })();
    </script>
</dom-module>